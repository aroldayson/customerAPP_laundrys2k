<!-- <div class="welcome-banner">
  <h1>WELCOME CUSTOMER</h1>
  <p>Thank you for choosing S2K Laundry Shop!</p>
</div> -->



<!-- <div class="hero-wrap vh-100 d-flex align-items-center" style="background-image: url('assets/bg.png'); background-size: cover; background-position: center;">
  <div class="w-100 h-100 position-absolute bg-dark opacity-50"></div>
  <div class="container position-relative">
    <div class="row align-items-center h-100">
      <div class="col-md-6">
        <h2 class="text-light">Leave the house cleaning chores to us</h2>
        <h1 class="mb-4 text-white">Let us do the dirty work, so you don't have to.</h1>
        <a href="#" class="btn btn-primary py-2 px-4">Learn more <span class="ms-2">&rarr;</span></a>
      </div>
    </div>
  </div>
</div> -->


<!-- <div class="container-fluid">
  <div class="d-flex flex-wrap justify-content-between align-items-center my-3">
    <button class="btn btn-primary mb-2" (click)="gentrack()">
      New Transaction <i class="fa fa-plus-circle"></i>
    </button>
      <div class="search-container">
        <input type="text" id="searchInput" [(ngModel)]="keyword" autocomplete="off" placeholder="Search" class="search-input">
      </div>
    </div>
  <div class="table-responsive">
    <table class="table table-hover d-none d-md-table">
      <thead class="table-primary">
        <tr>
          <th scope="col"></th>
          <th scope="col">Tracking #</th>
          <th scope="col">Laundry Item</th>
          <th scope="col">Qty</th>
          <th scope="col">Weight</th>
          <th scope="col">Transaction Date</th>
          <th scope="col">Estimated Date</th>
          <th scope="col">Status</th>
          <th scope="col">Price</th>
          <th scope="col">Estimated Price</th>
          <th scope="col">Service</th>
          <th scope="col">Action</th>
        </tr>
      </thead>
      <tbody>
        @for (item of trans | searchFilter: keyword ; track item.trans_ID) {
        <tr>
          <td></td>
          <td (click)="viewItem(item.trans_ID)">{{item.track_num}}</td>
          <td (click)="viewItem(item.trans_ID)">{{item.Category}}</td>
          <td (click)="viewItem(item.trans_ID)">{{item.totalQty}}</td>
          <td (click)="viewItem(item.trans_ID)">{{item.totalWeight}}</td>
          <td (click)="viewItem(item.trans_ID)">{{item.trans_date}}</td>
          <td (click)="viewItem(item.trans_ID)">{{item.estimated_date}}</td>
          <td><span class="status pending">{{item.trans_stat}}</span></td>
          <td >{{item.totalprice}}</td>
          <td >{{item.calculatedTotalPrice}}
            <i class="fa fa-info-circle" 
              aria-hidden="true" 
              data-bs-toggle="tooltip" 
              data-bs-placement="left" 
              title="Total Price might change base on additional services and laundry weight">
            </i>
          </td>
          <td>{{item.Addservice_name}}</td>
          <td>
            <button class="btn btn-sm btn-primary me-2" 
            [disabled]="item.trans_stat.toLowerCase() !== 'pending'"
            (click)="showDetails(item.track_num, item, item.trans_ID)">
              <i class="fa fa-pencil"></i>
            </button>
            <button 
            class="btn btn-sm btn-danger" 
            [disabled]="item.trans_stat.toLowerCase()!== 'pending'"
            (click)="updateStatus(item.trans_ID)">
            <i class="fa fa-trash"></i>
          </button>
          </td>
        </tr>
        }
      </tbody>
    </table>

    
    <div class="mobile-table d-md-none">
      @for (item of trans | searchFilter: keyword ; track item.trans_ID) {
      <div class="card mb-3 shadow-sm">
        <div class="card-body" (click)="viewItem(item.trans_ID)">
          <h5 class="card-title">
            Tracking #: {{item.track_num}}
          </h5>
          <p class="card-text">
            <strong>Item:</strong> {{item.Category}}<br>
            <strong>Qty:</strong> {{item.totalQty}}<br>
            <strong>Weight:</strong> {{item.totalWeight}}<br>
            <strong>Date:</strong> {{item.trans_date}}<br>
            <strong>Estimated Date:</strong> {{item.estimated_date}}<br>
            <strong>Status:</strong> <span class="status pending">{{item.trans_stat}}</span><br>
            <strong>Price:</strong> {{item.totalprice}}<br>
            <strong>Estimated Price:</strong> {{item.calculatedTotalPrice}} 
            <i class="fa fa-info-circle" 
            aria-hidden="true" 
            data-bs-toggle="tooltip" 
            data-bs-placement="right" 
            title="Total Price might change base on additional services and laundry weight">
          </i><br>
            <strong>Service:</strong> {{item.Addservice_name}}
          </p>
          <div class="d-flex">
            <button class="btn btn-primary btn-sm me-2"
            [disabled]="item.trans_stat.toLowerCase() !== 'pending'"
             (click)="showDetails(item.track_num, item, item.trans_ID); $event.stopPropagation()">
              <i class="fa fa-pencil"></i> Edit
            </button>
            <button class="btn btn-danger btn-sm"
            [disabled]="item.trans_stat.toLowerCase() !== 'pending'"
             (click)="updateStatus(item.trans_ID); $event.stopPropagation()">
             <i class="fa fa-trash"></i> Delete
            </button>
          </div>
        </div>
      </div>
      }
    </div>
  </div>
</div> -->




<div class="header">
  <h1>S2K Laundry</h1>
  <p><span style="color: #15304f;">Welcome back </span><span style="color: #87bfff;">Customer Eleizer</span></p>
  <button class="btn btn-new mb-2" (click)="gentrack()">NEW TRANSACTION</button>
</div>

<!-- Container for Search and Card Layout -->
<div class="container my-4">

  <!-- Search Container -->
  <div class="search-container mb-4">
    <input
      type="text"
      id="searchInput"
      [(ngModel)]="keyword"
      autocomplete="off"
      placeholder="Search Transactions..."
      class="search-input form-control shadow-lg rounded-pill py-2 px-4"
    />
  </div>

  <!-- Card Container -->
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
    @for (item of trans | searchFilter: keyword; track item.trans_ID) {
      <div class="col">
        <div class="card shadow-lg border-0 rounded-3 h-100">
          
          <!-- Card Header with Tracking Number -->
          <div class="card-header text-center">
            <h5 class="card-title text-primary">
              <strong>Tracking #:</strong> {{ item.track_num }}
            </h5>
          </div>
          
          <!-- Card Body with Transaction Details -->
          <div class="card-body" (click)="viewItem(item.trans_ID)">
            <p class="card-text">
              <strong>Laundry Item:</strong> {{ item.Category }}<br />
              <strong>Quantity:</strong> {{ item.totalQty }}<br />
              <strong>Weight:</strong> {{ item.totalWeight }}<br />
              <strong>Transaction Date:</strong> {{ item.trans_date }}<br />
              <strong>Estimated Date:</strong> {{ item.estimated_date }}<br />
              <strong>Status:</strong>
              <span
                [ngClass]="{
                  'text-warning': item.trans_stat === 'Pending',
                  'text-success': item.trans_stat === 'Completed'
                }"
              >
                {{ item.trans_stat }}
              </span>
              <br />
              <strong>Price:</strong> {{ item.totalprice | currency:'PHP':'symbol':'1.2-2'}}<br />
              <strong>Estimated Price:</strong> {{ item.calculatedTotalPrice | currency:'PHP':'symbol':'1.2-2' }}

              <i
                class="fa fa-info-circle text-info"
                aria-hidden="true"
                data-bs-toggle="tooltip"
                data-bs-placement="left"
                title="Total Price might change based on additional services and laundry weight"
              ></i>
              <br />
              <strong>Service:</strong> {{ item.Addservice_name }}
            </p>
          </div>
          
          <!-- Card Footer with Action Buttons -->
          <div class="card-footer d-flex justify-content-between align-items-center">
            <button
              class="btn btn-edit btn-sm"
              [disabled]="item.trans_stat.toLowerCase() !== 'pending'"
              (click)="showDetails(item.track_num, item, item.trans_ID)"
            >
              <i class="fa fa-pencil"></i> Edit
            </button>
            <button
              class="btn btn-delete btn-sm"
              [disabled]="item.trans_stat.toLowerCase() !== 'pending'"
              (click)="updateStatus(item.trans_ID)"
            >
              <i class="fa fa-trash"></i> Delete
            </button>
          </div>

        </div>
      </div>
    }
  </div>

</div>

<!-- Modal -->
<div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" #updateModal>
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content shadow-lg border-0 rounded-3">
      <div class="modal-header text-white" style="background-color: #5998e2;">
        <h5 class="modal-title fw-bold">Update Transaction</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>

      <div class="modal-body">
        <div class="alert alert-light shadow-sm rounded mb-4 p-3">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <div>
              <p class="mb-0">
                <span class="text-muted fw-medium">Tracking Number:</span>
                <span class="text-primary fw-bold">{{ selectedTransaction?.track_num }}</span>
              </p>
            </div>
            <button class="btn btn-outline-primary btn-sm" (click)="copyToClipboard(selectedTransaction?.track_num)">
              <i class="fa fa-copy"></i> Copy
            </button>
          </div>
          <p class="mb-0">
            <span class="text-muted fw-medium">Status:</span>
            <span class="fw-bold">{{ selectedTransaction?.trans_stat }}</span>
          </p>
          <!-- <p class="mb-0">
            <span class="text-muted fw-medium">Address:</span>
            @for(a of address ; track a){
            <span class="fw-bold">{{a.Province}} {{a.Town_City}} {{ a.Barangay }} </span>
            }
          </p> -->
        </div>

        <!-- Service Selection Form -->
        <form #form="ngForm">
          <div class="mb-4">
            <label class="fw-medium text-muted mb-2">Selected Service</label>
            <div class="d-flex flex-wrap gap-3">
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="rush"
                  [checked]="selectedservices.rush"
                  (change)="onCheckboxChange('Rush Job', $event)"
                />
                <label class="form-check-label" for="rush">Rush Jobs</label>
              </div>
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="pick"
                  [checked]="selectedservices.pick"
                  (change)="onCheckboxChange('PickUp-Service', $event)"
                />
                <label class="form-check-label" for="pick">Pick-up</label>
              </div>
              <div class="form-check form-switch">
                <input
                  class="form-check-input"
                  type="checkbox"
                  id="deliver"
                  [checked]="selectedservices.deliver"
                  (change)="onCheckboxChange('Delivery-Service', $event)"
                />
                <label class="form-check-label" for="deliver">Delivery</label>
              </div>
            </div>
          </div>
        </form>

          <div class="row" [hidden]="selectAddDel==false">
          <p>Select your Delivery Address.</p>
          <div class="col-md-4 mb-3">
            <label for="town" class="form-label">Town</label>
            <select class="form-select" id="town" [(ngModel)]="deliveryTown" (change)="getTownValue($event)">
              <option value="" disabled selected>Select Town</option>
              <option *ngFor="let town of townAddresses" [value]="town.City_Address">
                {{ town.City_Address }}
              </option>
            </select>
          </div>
        
          <!-- Barangay Dropdown -->
          <div class="col-md-4 mb-3" [hidden]="selectBar==false">
            <label for="barangay" class="form-label">Barangay</label>
            <select class="form-select" id="barangay" [(ngModel)]="deliveryBarangay">
              <option value="" disabled selected>Select Barangay</option>
              
              <!-- Sison Barangays -->
              <option [hidden]="sison == false" *ngFor="let barangay of barangaysInSison" [value]="barangay">
                {{ barangay }}
              </option>
        
              <!-- Rosario Barangays -->
              <option [hidden]="rosario == false" *ngFor="let barangay of barangaysInRosario" [value]="barangay">
                {{ barangay }}
              </option>
        
              <!-- Nearby Barangays -->
              <option [hidden]="poz == false" *ngFor="let barangay of barangaysInPoz" [value]="barangay">
                {{ barangay }}
              </option>
        
              <!-- Barangays Near Rosario -->
              <option [hidden]="pugo == false" *ngFor="let barangay of barangaysInPugo" [value]="barangay">
                {{ barangay }}
              </option>
            </select>
          </div>
        
          <div class="col-md-4 mb-3" *ngIf="sison == true || rosario == true || poz == true || pugo == true">
            <label for="barangayInput" class="form-label">Building# and street</label>
            <input type="text" class="form-control" id="barangayInput" [(ngModel)]="deliveryStreet" placeholder="Enter details">
          </div>
        </div>
        
        
        
        <div class="row" [hidden]="selectAddPick==false">
          <p>Select your Pick-Up Address.</p>
          <div class="col-md-4 mb-3">
            <label for="picktown" class="form-label">Town</label>
            <select class="form-select" id="picktown" [(ngModel)]="selectedTownID" (change)="getTownValue($event)">
              <option value="" disabled selected>Select Town</option>
              <option *ngFor="let town of townAddresses" [value]="town.City_Address">
                {{ town.City_Address }}
              </option>
            </select>
          </div>
        
        
            <!-- Barangay Dropdown -->
            <div class="col-md-4 mb-3" [hidden]="selectBar==false">
              <label for="pickbarangay" class="form-label">Barangay</label>
              <select class="form-select" id="pickbarangay" formControlName="barangay">
                <option value="" disabled selected>Select Barangay</option>
                
                <!-- Sison Barangays -->
                <option [hidden]="sison == false" *ngFor="let barangay of barangaysInSison" [value]="barangay">
                  {{ barangay }}
                </option>
          
                <!-- Rosario Barangays -->
                <option [hidden]="rosario == false" *ngFor="let barangay of barangaysInRosario" [value]="barangay">
                  {{ barangay }}
                </option>
          
                <!-- Nearby Barangays -->
                <option [hidden]="poz == false" *ngFor="let barangay of barangaysInPoz" [value]="barangay">
                  {{ barangay }}
                </option>
          
                <!-- Barangays Near Rosario -->
                <option [hidden]="pugo == false" *ngFor="let barangay of barangaysInPugo" [value]="barangay">
                  {{ barangay }}
                </option>
                
              </select>
                 <!-- Input Field beside Barangay Dropdown -->
                </div>
                <div class="col-md-4 mb-3" *ngIf="sison == true || rosario == true || poz == true || pugo == true">
                 <label for="pickbarangayInput" class="form-label">Building# and street</label>
                 <input type="text" class="form-control" id="pickbarangayInput" placeholder="Enter details">
               </div>
              </div>

        <!-- Transaction Details Table -->
        <div class="table-responsive">
          <table class="table table-hover">
            <thead class="table-light">
              <tr>
                <th>Category</th>
                <th>Quantity</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let detail of selectedTransaction?.details; let i = index">
                <td>
                  <select class="form-select" [(ngModel)]="detail.Categ_ID">
                    <option value="" disabled>Select Category</option>
                    <ng-container *ngFor="let category of categ">
                      <option [value]="category.Categ_ID">{{ category.Category }}</option>
                    </ng-container>
                  </select>
                </td>
                <td>
                  <input
                    type="number"
                    class="form-control"
                    [(ngModel)]="detail.Qty"
                    placeholder="Enter quantity"
                    min="1"
                  />
                </td>
                <td>
                  <button class="btn btn-delete btn-sm" (click)="removeDetail(i)">
                    <i class="fa fa-trash"></i> Remove
                  </button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>

        <!-- Add Item Button -->
        <div class="text-end mt-3">
          <button class="btn btn-additem btn-sm" (click)="addDetail()">
            <i class="fa fa-plus"></i> Add Item
          </button>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          <i class="fa fa-times"></i> Close
        </button>
        <button type="button" class="btn btn-primary" (click)="updateTransaction()">
          <i class="fa fa-save"></i> Save Changes
        </button>
      </div>
    </div>
  </div>
</div>


















